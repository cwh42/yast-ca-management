/**
 * $Id$
 * Summary:
 *   SCR Agent for editing openssl.cnf.tmpl in CAM repository
 * Authors:
 *   Michael Calmer <mc@suse.de>
 */
.CAM.openssl_tmpl
`ag_ini(
    `IniAgent(
        [ "/var/lib/CAM/*/openssl.cnf.tmpl" ],
        $[
            "options" : [ "no_nested_sections", 
                          "line_can_continue"
                        ],
            "comments": [ "^[ \t]*#.*$", "#.*", "^[ \t]*$", "^[ \t]*;[^;]+.*$" ],
            "sections" : [
                $[
                    "begin" : [ "^[ \t]*\\[[ \t]*(.*[^ \t])[ \t]*\\][ \t]*", "[%s]" ],
                ],
                $[
                // this is a special type for commenting out the values
                    "begin" : [ "^[ \t]*;;[ \t]*\\[[ \t]*(.*[^ \t])[ \t]*\\][ \t]*", ";; [%s]" ],
                ],
            ],
            // we need to exclude ; because of the second matching rule
            "params" : [
                $[
                    "match" : [ "^[ \t]*([^=;]*[^ \t;=])[ \t]*=[ \t]*(.*[^ \t]|)[ \t]*$" , "   %s = %s"],
                ],
                $[
                    // this is a special type for commenting out the values
                    "match" : [ "^[ \t]*;;[ \t]*([^=]*[^ \t=])[ \t]*=[ \t]*(.*[^ \t]|)[ \t]*$" , ";;   %s = %s"],
                ],
            ],
            "rewrite": [
                        ["/var/lib/CAM/(.*)/openssl\.cnf\.tmpl",
                         "/var/lib/CAM/%s/openssl.cnf.tmpl"]
                       ],
       ]
    )
)
